<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laundry Service - Admin Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        .header { background: #2c3e50; color: white; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px; }
        .header h1 { display: inline-block; }
        .user-info { float: right; }
        .logout-btn { background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
        
        /* Login Form */
        .login-container { max-width: 400px; margin: 100px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { width: 100%; background: #3498db; color: white; padding: 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #2980b9; }
        
        /* Dashboard */
        .dashboard { display: none; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .stat-number { font-size: 2em; font-weight: bold; color: #3498db; }
        .stat-label { color: #666; margin-top: 5px; }
        
        /* Tabs */
        .tabs { margin-bottom: 20px; }
        .tab-buttons { display: flex; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-btn { flex: 1; padding: 15px; background: white; border: none; cursor: pointer; border-right: 1px solid #eee; }
        .tab-btn.active { background: #3498db; color: white; }
        .tab-btn:last-child { border-right: none; }
        
        /* Content */
        .tab-content { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }
        
        /* Tables */
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; font-weight: bold; }
        .status { padding: 4px 8px; border-radius: 12px; font-size: 0.8em; }
        .status.active { background: #d4edda; color: #155724; }
        .status.inactive { background: #f8d7da; color: #721c24; }
        
        /* Forms */
        .form-row { display: flex; gap: 15px; margin-bottom: 15px; }
        .form-row .form-group { flex: 1; margin-bottom: 0; }
        
        .hidden { display: none; }
        .clearfix::after { content: ""; display: table; clear: both; }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="loginContainer" class="login-container">
        <h2 style="text-align: center; margin-bottom: 30px;">üîê Admin Login</h2>
        <form id="loginForm">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" required>
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" required>
            </div>
            <button type="submit">Login</button>
        </form>
    </div>

    <!-- Dashboard -->
    <div id="dashboardContainer" class="container dashboard">
        <div class="header clearfix">
            <h1>üè¢ Admin Dashboard</h1>
            <div class="user-info">
                <span id="adminName">Admin User</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalUsers">0</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalVendors">0</div>
                <div class="stat-label">Total Vendors</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalOrders">0</div>
                <div class="stat-label">Total Orders</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="systemHealth">Healthy</div>
                <div class="stat-label">System Status</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('vendors')">üè™ Vendors</button>
                <button class="tab-btn" onclick="showTab('users')">üë• Users</button>
                <button class="tab-btn" onclick="showTab('orders')">üìã Orders</button>
                <button class="tab-btn" onclick="showTab('admins')">üë®‚Äçüíº Admins</button>
            </div>
        </div>

        <div class="tab-content">
            <!-- Vendors Tab -->
            <div id="vendorsTab" class="tab-pane active">
                <h3>Vendor Management</h3>
                <button onclick="showCreateAdminForm('vendor')" style="margin-bottom: 15px; background: #27ae60;">+ Create Vendor Admin</button>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="vendorsTable">
                        <tr>
                            <td>Clean Express Laundromat</td>
                            <td>admin@cleanexpress.com</td>
                            <td>+233201234567</td>
                            <td><span class="status active">Active</span></td>
                            <td>
                                <button onclick="viewVendor('1')">View</button>
                                <button onclick="deactivateVendor('1')">Deactivate</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Users Tab -->
            <div id="usersTab" class="tab-pane">
                <h3>User Management</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Credits</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="usersTable">
                        <tr>
                            <td>John Doe</td>
                            <td>john.doe@example.com</td>
                            <td>+233123456789</td>
                            <td>GHS 25.50</td>
                            <td><span class="status active">Active</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Orders Tab -->
            <div id="ordersTab" class="tab-pane">
                <h3>Order Management</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Vendor</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTable">
                        <tr>
                            <td>LD-2024-001</td>
                            <td>John Doe</td>
                            <td>Clean Express</td>
                            <td>GHS 31.16</td>
                            <td><span class="status active">In Progress</span></td>
                            <td>2024-01-01</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Admins Tab -->
            <div id="adminsTab" class="tab-pane">
                <h3>Admin Management</h3>
                <button onclick="showCreateAdminForm('super')" style="margin-bottom: 15px; background: #e74c3c;">+ Create Super Admin</button>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Last Login</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="adminsTable">
                        <tr>
                            <td>Super Admin</td>
                            <td>admin@laundryservice.com</td>
                            <td>Super Admin</td>
                            <td>2024-01-01 10:30</td>
                            <td><span class="status active">Active</span></td>
                            <td>
                                <button onclick="deactivateAdmin('1')">Deactivate</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Create Admin Modal -->
    <div id="createAdminModal" class="login-container hidden">
        <h3 id="modalTitle">Create Admin</h3>
        <form id="createAdminForm">
            <div class="form-row">
                <div class="form-group">
                    <label for="firstName">First Name:</label>
                    <input type="text" id="firstName" required>
                </div>
                <div class="form-group">
                    <label for="lastName">Last Name:</label>
                    <input type="text" id="lastName" required>
                </div>
            </div>
            <div class="form-group">
                <label for="adminEmail">Email:</label>
                <input type="email" id="adminEmail" required>
            </div>
            <div class="form-group">
                <label for="adminPassword">Password:</label>
                <input type="password" id="adminPassword" required>
            </div>
            <div class="form-group">
                <label for="role">Role:</label>
                <select id="role" required>
                    <option value="super_admin">Super Admin</option>
                    <option value="vendor_admin">Vendor Admin</option>
                </select>
            </div>
            <div class="form-group" id="vendorSelectGroup" style="display: none;">
                <label for="vendorSelect">Vendor:</label>
                <select id="vendorSelect">
                    <option value="">Select Vendor</option>
                </select>
            </div>
            <button type="submit">Create Admin</button>
            <button type="button" onclick="hideCreateAdminForm()" style="background: #95a5a6; margin-top: 10px;">Cancel</button>
        </form>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api/v1';
        let authToken = localStorage.getItem('adminToken');
        let currentAdmin = null;

        // Initialize
        if (authToken) {
            showDashboard();
            loadDashboardData();
        }

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch(`${API_BASE}/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    currentAdmin = data.admin;
                    localStorage.setItem('adminToken', authToken);
                    showDashboard();
                    loadDashboardData();
                } else {
                    alert('Login failed: ' + data.message);
                }
            } catch (error) {
                alert('Login error: ' + error.message);
            }
        });

        function showDashboard() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('dashboardContainer').style.display = 'block';
            
            if (currentAdmin) {
                document.getElementById('adminName').textContent = 
                    `${currentAdmin.firstName} ${currentAdmin.lastName} (${currentAdmin.role})`;
            }
        }

        async function loadDashboardData() {
            try {
                const response = await fetch(`${API_BASE}/admin/dashboard`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    updateStats(data.data);
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        function updateStats(stats) {
            document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
            document.getElementById('totalVendors').textContent = stats.totalVendors || 0;
            document.getElementById('totalOrders').textContent = stats.totalOrders || 0;
            document.getElementById('systemHealth').textContent = stats.systemHealth || 'Unknown';
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        function showCreateAdminForm(type) {
            document.getElementById('createAdminModal').classList.remove('hidden');
            document.getElementById('modalTitle').textContent = 
                type === 'super' ? 'Create Super Admin' : 'Create Vendor Admin';
            
            const roleSelect = document.getElementById('role');
            const vendorGroup = document.getElementById('vendorSelectGroup');
            
            if (type === 'vendor') {
                roleSelect.value = 'vendor_admin';
                vendorGroup.style.display = 'block';
            } else {
                roleSelect.value = 'super_admin';
                vendorGroup.style.display = 'none';
            }
        }

        function hideCreateAdminForm() {
            document.getElementById('createAdminModal').classList.add('hidden');
            document.getElementById('createAdminForm').reset();
        }

        // Create admin form
        document.getElementById('createAdminForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('adminEmail').value,
                password: document.getElementById('adminPassword').value,
                role: document.getElementById('role').value,
            };

            if (formData.role === 'vendor_admin') {
                formData.vendorId = document.getElementById('vendorSelect').value;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    alert('Admin created successfully');
                    hideCreateAdminForm();
                    // Reload admins table
                } else {
                    const error = await response.json();
                    alert('Error creating admin: ' + error.message);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        function logout() {
            localStorage.removeItem('adminToken');
            authToken = null;
            currentAdmin = null;
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('dashboardContainer').style.display = 'none';
        }

        function viewVendor(id) {
            alert(`View vendor details for ID: ${id}`);
        }

        function deactivateVendor(id) {
            if (confirm('Are you sure you want to deactivate this vendor?')) {
                alert(`Vendor ${id} deactivated`);
            }
        }

        function deactivateAdmin(id) {
            if (confirm('Are you sure you want to deactivate this admin?')) {
                alert(`Admin ${id} deactivated`);
            }
        }
    </script>
</body>
</html>
